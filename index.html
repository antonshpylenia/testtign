<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Visibility & Focus Test</title>
<style>
  body {
    font-family: monospace;
    background: #111;
    color: #eee;
    padding: 20px;
  }
  #toolbar {
    margin-bottom: 10px;
  }
  button {
    background: #333;
    color: #fff;
    border: 1px solid #666;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
  }
  button:hover {
    background: #444;
  }
  #log {
    border: 1px solid #444;
    padding: 10px;
    height: 60vh;
    overflow-y: auto;
    background: #000;
  }
  .event {
    margin-bottom: 6px;
  }
  .hidden { color: #f77; }
  .focus { color: #7f7; }
  .blur { color: #ff7; }
  .mouse { color: #7af; }
</style>
</head>
<body>
  <h2>üß† Visibility & Focus Event Logger</h2>
  <div id="toolbar">
    <button id="clearLogs">üßπ Clear Logs</button>
  </div>
  <div id="log"></div>

  <script>
    const logBox = document.getElementById('log');
    const clearBtn = document.getElementById('clearLogs');

    function log(msg, cls = '') {
      const div = document.createElement('div');
      div.className = `event ${cls}`;
      div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      logBox.appendChild(div);
      logBox.scrollTop = logBox.scrollHeight;
      console.log(msg);
    }

    // Clear log button
    clearBtn.addEventListener('click', () => {
      logBox.innerHTML = '';
      log('üßπ Logs cleared');
    });

    // Page Visibility API
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        log('document.hidden = true (tab not visible)', 'hidden');
      } else {
        log('document.hidden = false (tab visible again)', 'focus');
      }
    });

    // Focus/Blur on window
    window.addEventListener('focus', () => log('window focus', 'focus'));
    window.addEventListener('blur', () => log('window blur', 'blur'));

    // Mouse leaves window (good for detecting intent to close or switch)
    window.addEventListener('mouseout', e => {
      if (!e.relatedTarget && !e.toElement) {
        log('mouse left window ‚Üí possible tab switch or close', 'mouse');
      }
    });

    // Mouse reenters window
    window.addEventListener('mouseover', e => {
      if (!e.relatedTarget && !e.fromElement) {
        log('mouse reentered window', 'mouse');
      }
    });

    // Before unload (user tries to close or refresh tab)
    window.addEventListener('beforeunload', e => {
      log('‚ö†Ô∏è beforeunload event fired (tab close/refresh attempt)', 'hidden');
      // Uncomment to test confirmation dialog (some browsers ignore it)
      // e.preventDefault();
      // e.returnValue = '';
    });

    log('Logger initialized. Waiting for events...');
  </script>
</body>
</html>
